<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0-internal) on Mon Jan 03 15:44:21 EST 2022 -->
<title>KcopSingleRowAvroAuditIntegrated (IBM InfoSphere Data Replication Change Data Capture API Documentation)</title>
<meta name="date" content="2022-01-03">
<link rel="stylesheet" type="text/css" href="../../../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="KcopSingleRowAvroAuditIntegrated (IBM InfoSphere Data Replication Change Data Capture API Documentation)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div role="navigation" title ="TOP_Navigation" aria-label ="Top Navigation Bar"/>
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/KcopSingleRowAvroAuditIntegrated.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html" title="class in com.datamirror.ts.target.publication.userexit.sample.kafka"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopTopicMappingIntegrated.html" title="class in com.datamirror.ts.target.publication.userexit.sample.kafka"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../../index.html?com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditIntegrated.html" target="_top">Frames</a></li>
<li><a href="KcopSingleRowAvroAuditIntegrated.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#fields.inherited.from.class.com.datamirror.ts.target.publication.userexit.sample.kafka.KcopSingleRowAvroAuditHeadersIntegrated">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#methods.inherited.from.class.com.datamirror.ts.target.publication.userexit.sample.kafka.KcopSingleRowAvroAuditHeadersIntegrated">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div role="main" title ="KcopSingleRowAvroAuditIntegrated" aria-labelledby ="Header1"/>
<div class="header">
<div class="subTitle">com.datamirror.ts.target.publication.userexit.sample.kafka</div>
<h2 title="Class KcopSingleRowAvroAuditIntegrated" class="title" id="Header1">Class KcopSingleRowAvroAuditIntegrated</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>com.datamirror.ts.target.publication.userexit.sample.kafka.AbstractKcop</li>
<li>
<ul class="inheritance">
<li>com.datamirror.ts.target.publication.userexit.sample.kafka.AbstractAvroKcop</li>
<li>
<ul class="inheritance">
<li><a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html" title="class in com.datamirror.ts.target.publication.userexit.sample.kafka">com.datamirror.ts.target.publication.userexit.sample.kafka.KcopSingleRowAvroAuditHeadersIntegrated</a></li>
<li>
<ul class="inheritance">
<li>com.datamirror.ts.target.publication.userexit.sample.kafka.KcopSingleRowAvroAuditIntegrated</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/kafka/KafkaCustomOperationProcessorIF.html" title="interface in com.datamirror.ts.target.publication.userexit.kafka">KafkaCustomOperationProcessorIF</a></dd>
</dl>
<hr>
<br>
<pre>public class <span class="typeNameLabel">KcopSingleRowAvroAuditIntegrated</span>
extends <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html" title="class in com.datamirror.ts.target.publication.userexit.sample.kafka">KcopSingleRowAvroAuditHeadersIntegrated</a></pre>
<div class="block"><p>This sample produces an audit record in avro format. It uses journal control fields available in
  the Kcop API and uses an avro serializer to produce a generic avro record.  It places both the before
  and after images, where appropriate, on a single row.  The before and after images may either exist or be a null
  instead depending on the operation.</p>
  
  <br> In MC the user exits class name is: com.datamirror.ts.target.publication.userexit.sample.kafka.KcopSingleRowAvroAuditsIntegrated
  <br> In MC the user exit parameter may either start with "-file:" to indicate property file, or simply be a schema registry url.
  <br> eg. -file:/home/nz/CDC/KCOP.properties
  <p>
  The input parameter can be the schema registry url, or a properties file. The properties file
  can be specified by using -file:[properties_file_path] in the user exit parameter.</p>
  
  <p>The properties file can define the following parameters:</p>
  
  schema.registry - the schema registry url
  <br>audit.jcfs - a comma-separated list of journal control field names to be added to each record
  <br>header.jcfs - a comma-separated list of jcfs to include in the header of the record.
  <br>header.columns - a comma-separated list of <source topic>.column to include in the header for operations related to the source topics.
  <br>                 Note that the value of a header is a byte array and .toString is used on the column value as the basis of providing those bytes.
  <br>                 Ensure that the column you select for the header returns something meaningful were .toString() to be called on the column value.
  <br>                           If a given column, identified to be a header, does not exist for the table mapping in question then nothing is added to the headers.
  <br>headers.include.schema - a boolean that if set to "true" will include the value schema of the producer record as a header.  The header key is "ValueRecordSchema"
  <br>header.prefix - a prefix that will be added in front of the key for all headers this KCOP produces
 
  <p>By default, the journal control fields that will be used are ENTTYP, TIMSTAMP, JOB, JOBUSER. See <code>JournalControlField</code>
  for the list of available journal control fields. To specify ENTTYP and CCID, create a properties file containing:</p>
  <p>
  schema.registry=https://[schema_registry_url]:[schema_registry_port]
  <br>audit.jcfs=ENTTYP,CCID </p>
  
  Additionally this KCOP allows the user to choose which topic a given source table's operations are to be
  written to at a source table granularity.</p>

  <p>To Explicitly map a given source to a given topic name use MAP_TABLE_ as a prefix to the default topic name.
  The following file example would map all tables to a default topic named DefaultTopicTest and 
  kafka1.kafka_multi_tab.sourcedb.shawnrr.tab2 to a topic named remappedTab2.</p>

  <br>$ cat kcopTopicMapping.properties 
  <br>schema.registry.url=http://localhost:8081
  <br>MAP_DEFAULT=DefaultTopicTest
  <br>MAP_TABLE_kafka1.kafka_multi_tab.sourcedb.shawnrr.tab2=remappedTab2

  <p>To map all source tables to a single topic use MAP_ALL rather than using MAP_ DEFAULT with no explicit mappings.
  Both would technically work, but MAP_ALL avoids an internal lookup for every call to createProducerRecords.</p>

  <br>[nz@shawnrrvm conf]$ cat kcopTopicMapping.properties 
  <br>schema.registry.url=http://localhost:8081
  <br>MAP_ALL=OneTopicToRuleThemAll

  <p> When combining multiple records from different source tables to the same topic, it may be wise to include a source
  table column in the mapping so you'll know which table the record consumed corresponded to. </p>
  
   <p>NOTE 1:  The createProducerRecords class is multi threaded and thread safe.  As multiple threads can execute create producer record any alterations to this 
   file must be multi-thread aware.    A means is provided so that each thread can store its own copy of non-theadsafe objects.  Please see how this is done below.</p>
    
  <p>NOTE 2:  The records returned by createProducerRecords are not deep copied, so each call to the method should
   generate new records and not attempt to keep references to old ones for reuse. This is already demonstrated in the KCOP.</p>
   
  <p>Note 3:  The KCOP is instantiated once per subscription which registers the KCOP.  This means if statics are made
   use of, they will potentially be shared across the instantiated KCOPs belonging to multiple actively replicating 
   subscriptions.</p>
   
   <p>NOTE 4:  A kafka key must be defined for the subscription.</p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="fields.inherited.from.class.com.datamirror.ts.target.publication.userexit.sample.kafka.KcopSingleRowAvroAuditHeadersIntegrated">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;com.datamirror.ts.target.publication.userexit.sample.kafka.<a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html" title="class in com.datamirror.ts.target.publication.userexit.sample.kafka">KcopSingleRowAvroAuditHeadersIntegrated</a></h3>
<code><a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#BEFORE_SCHEMA_PREFIX">BEFORE_SCHEMA_PREFIX</a>, <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#DEFAULT_AUDIT_COLUMNS">DEFAULT_AUDIT_COLUMNS</a>, <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#FORCED_NULLABLE_LOB_COLUMNS">FORCED_NULLABLE_LOB_COLUMNS</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditIntegrated.html#KcopSingleRowAvroAuditIntegrated--">KcopSingleRowAvroAuditIntegrated</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.com.datamirror.ts.target.publication.userexit.sample.kafka.KcopSingleRowAvroAuditHeadersIntegrated">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;com.datamirror.ts.target.publication.userexit.sample.kafka.<a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html" title="class in com.datamirror.ts.target.publication.userexit.sample.kafka">KcopSingleRowAvroAuditHeadersIntegrated</a></h3>
<code><a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#changeNameSpaceIfNecessary-org.apache.avro.Schema-">changeNameSpaceIfNecessary</a>, <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#createKafkaAuditAvroBinaryProducerRecord-org.apache.avro.generic.GenericRecord-com.datamirror.ts.target.publication.userexit.kafka.KafkaKcopReplicationCoordinatorIF-com.datamirror.ts.target.publication.userexit.kafka.KafkaKcopOperationInIF-com.datamirror.ts.target.publication.userexit.sample.kafka.ThreadSpecificContext-">createKafkaAuditAvroBinaryProducerRecord</a>, <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#createKafkaAuditAvroRecord-org.apache.avro.Schema-org.apache.avro.generic.GenericRecord-org.apache.avro.Schema-com.datamirror.ts.target.publication.userexit.kafka.KafkaKcopOperationInIF-">createKafkaAuditAvroRecord</a>, <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#createProducerRecords-com.datamirror.ts.target.publication.userexit.kafka.KafkaKcopOperationInIF-com.datamirror.ts.target.publication.userexit.kafka.KafkaKcopReplicationCoordinatorIF-">createProducerRecords</a>, <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#finish-com.datamirror.ts.target.publication.userexit.kafka.KafkaKcopReplicationCoordinatorIF-">finish</a>, <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#generateAfterSchema-org.apache.avro.Schema-">generateAfterSchema</a>, <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#generateBeforeSchema-org.apache.avro.Schema-">generateBeforeSchema</a>, <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#generateKafkaAuditValueSchema-org.apache.avro.Schema-org.apache.avro.Schema-com.datamirror.ts.target.publication.userexit.ReplicationEventPublisherIF-">generateKafkaAuditValueSchema</a>, <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#init-com.datamirror.ts.target.publication.userexit.kafka.KafkaKcopReplicationCoordinatorIF-">init</a>, <a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html#tracksJcfs--">tracksJcfs</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.com.datamirror.ts.target.publication.userexit.kafka.KafkaCustomOperationProcessorIF">
<!--   -->
</a>
<h3>Methods inherited from interface&nbsp;com.datamirror.ts.target.publication.userexit.kafka.<a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/kafka/KafkaCustomOperationProcessorIF.html" title="interface in com.datamirror.ts.target.publication.userexit.kafka">KafkaCustomOperationProcessorIF</a></h3>
<code><a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/kafka/KafkaCustomOperationProcessorIF.html#createKafkaRecords-com.datamirror.ts.target.publication.userexit.kafka.KafkaKcopOperationInIF-com.datamirror.ts.target.publication.userexit.kafka.KafkaKcopReplicationCoordinatorIF-">createKafkaRecords</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="KcopSingleRowAvroAuditIntegrated--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>KcopSingleRowAvroAuditIntegrated</h4>
<pre>public&nbsp;KcopSingleRowAvroAuditIntegrated()</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div role="navigation" title ="Bottom_NAVIGATION" aria-label ="Bottom Navigation Bar"/>
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/KcopSingleRowAvroAuditIntegrated.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditHeadersIntegrated.html" title="class in com.datamirror.ts.target.publication.userexit.sample.kafka"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../../com/datamirror/ts/target/publication/userexit/sample/kafka/KcopTopicMappingIntegrated.html" title="class in com.datamirror.ts.target.publication.userexit.sample.kafka"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../../index.html?com/datamirror/ts/target/publication/userexit/sample/kafka/KcopSingleRowAvroAuditIntegrated.html" target="_top">Frames</a></li>
<li><a href="KcopSingleRowAvroAuditIntegrated.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#fields.inherited.from.class.com.datamirror.ts.target.publication.userexit.sample.kafka.KcopSingleRowAvroAuditHeadersIntegrated">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#methods.inherited.from.class.com.datamirror.ts.target.publication.userexit.sample.kafka.KcopSingleRowAvroAuditHeadersIntegrated">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<div role="contentinfo" title ="contentinfo_title" aria-label ="Contains footer note"/>
<p class="legalCopy"><small><i>Licensed Materials - Property of IBM &copy; Copyright IBM Corp. 1994, 2015</i></small></p>
</body>
</html>
